---
title: "IL2RA"
author: "Tea Heikkil√§, Emilia Kaiser & Jaakko Koskenniemi"
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
    code_folding: hide
date: '2023-12-01'
editor_options:
  chunk_output_type: console
---

Load packages and import data
```{r}

here::i_am("analyses/IL2RA.Rmd")

source("code/01-Functions.R")
```


# eQTL

TwoSampleMR is used to harmonize the data even though TwoSampleMR is not run. Therefore, data includes variable "beta" which is actually a z-score

```{r}
IL2RA_eqtl <- import_data("data/export_harmonization/IL2RA_eqtl_TwoSampleMR.csv",
            "data/export_harmonization/IL2RA_T1D_TwoSampleMR.csv", has_beta = TRUE)

```

## Initial Manhattan plots
```{r}
manhattan_plots(IL2RA_eqtl, gene_start=6010689, gene_end=6062370, title = "IL2RA")
IL2RA_eqtl <- IL2RA_eqtl %>% filter(pos.outcome > 5780000 & pos.outcome < 6250000) 
manhattan_plots(IL2RA_eqtl, gene_start=6010689, gene_end=6062370, title = "IL2RA")
```

## Coloc assuming 1 causal variant
```{r}
coloc_results_IL2RA_eqtl <- analyze_coloc_eqtl(IL2RA_eqtl)
# coloc_results_IL2RA_eqtl$coloc_D1D2 #coloc results
# coloc_results_IL2RA_eqtl$D1 #data eQTL
# coloc_results_IL2RA_eqtl$D2 #data t1d

```

## Regional manhattan plot

```{r}

load("data/export_LDmat/IL2RA_eqtl_LDmat.rda")

plot_coloc(genechr = 10,
           fig_start = 5780000,
           fig_end = 6250000,
           coloc_results = coloc_results_IL2RA_eqtl$coloc_D1D2,
           data = IL2RA_eqtl,
           D1 = coloc_results_IL2RA_eqtl$D1,
           D2 = coloc_results_IL2RA_eqtl$D2,
           LDmat = IL2RA)

ggsave(filename = "figures/IL2RA.png", height = 8, width = 6)
```

## MR
```{r}

#Find top SNP
coloc_results_IL2RA_eqtl$coloc_D1D2$results$snp[which.max(coloc_results_IL2RA_eqtl$coloc_D1D2$results$SNP.PP.H4)] #rs61839660

#Filter top SNP
IL2RA_eqtl_rs61839660   <- IL2RA_eqtl %>% filter(SNP == "rs61839660")

#Calculate beta for outcome (not MR)
exp(IL2RA_eqtl_rs61839660$beta.outcome)


#Calculate F statistic
IL2RA_eqtl_rs61839660 %>% 
  mutate(Fstat = (beta.exposure/se.exposure)^2)

#Calculate 95% CI for beta for outcome (not MR)
exp(IL2RA_eqtl_rs61839660$beta.outcome - 1.96 * IL2RA_eqtl_rs61839660$se.outcome)
exp(IL2RA_eqtl_rs61839660$beta.outcome + 1.96 * IL2RA_eqtl_rs61839660$se.outcome)

#Run MR
MR_IL2RA_eqtl_rs61839660   <- TwoSampleMR::mr(IL2RA_eqtl_rs61839660)

#MR results (unexponentiated beta and se)
MR_IL2RA_eqtl_rs61839660

#Exponentiate 
exp(MR_IL2RA_eqtl_rs61839660$b)
exp(MR_IL2RA_eqtl_rs61839660$b - 1.96*MR_IL2RA_eqtl_rs61839660$se)
exp(MR_IL2RA_eqtl_rs61839660$b + 1.96*MR_IL2RA_eqtl_rs61839660$se)


#Look how our variant (rs61839660) relates to top hits by Robertson et al.
load("data/export_LDmat/IL2RA_tophits.rda")
signif(IL2RA_SNPs_LD^2, 2)

```


## Functional variants

```{r}
load("data/export_functional_variants/phenoscanner-entries.RDS")

#Look for missense variants for IL2RA 
functional_variants$IL2RA$results %>% 
  filter(consequence == "missense") %>%  
  distinct(rsid) #only rs72650666

#Do we have data for IL2RA eqtl fo this variant?
IL2RA_eqtl_orig <- read_csv("data/export_harmonization/IL2RA_eqtl_TwoSampleMR.csv")
IL2RA_eqtl_orig %>%
  filter(SNP == "rs72650666") #no

#Do we have data for T1D risk for this variant?
IL2RA_T1D <- read_csv("data/export_harmonization/IL2RA_T1D_TwoSampleMR.csv")
IL2RA_T1D %>%
  filter(SNP == "rs72650666") #yes

# MR cannot be done because we don't have eQTL data

```

## pQTL

Per request of reviewers
```{r}
IL2RA_pqtl <- import_data("data/export_harmonization/IL2RA_prot_anno_TwoSampleMR.csv",
            "data/export_harmonization/IL2RA_T1D_TwoSampleMR.csv", has_beta = TRUE)

IL2RA_pqtl

coloc_results_IL2RA_pqtl <- analyze_coloc_pqtl_nosensitivitity(IL2RA_pqtl)
```


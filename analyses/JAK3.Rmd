---
title: "JAK3 eQTL"
author: "Tea Heikkil√§, Emilia Kaiser & Jaakko Koskenniemi"
output: html_document
date: '2022-12-01'
editor_options:
  chunk_output_type: console
---

  Load packages and import data
```{r}

source("code/01-Functions.R")

here::i_am("analyses/JAK3.Rmd")

```

# eQTL

Import data 
```{r}
JAK3_eqtl <- import_data("data/export_harmonization/JAK3_eqtl_TwoSampleMR.csv", 
                         "data/export_harmonization/JAK3_T1D_TwoSampleMR.csv", has_beta = TRUE)
```

## Initial Manhattan plots
```{r}
manhattan_plots(JAK3_eqtl, gene_start=17935589, gene_end=17958880, title = "JAK3")
JAK3_eqtl <- JAK3_eqtl %>% filter(pos.outcome > 17750000 & pos.outcome < 18750000) 
manhattan_plots(JAK3_eqtl, gene_start=17935589, gene_end=17958880, title = "JAK3")
```

## Coloc assuming 1 causal variant
```{r}
coloc_results_JAK3_eqtl <- analyze_coloc_eqtl(JAK3_eqtl)
# coloc_results_JAK3_eqtl$coloc_D1D2 #coloc results
# coloc_results_JAK3_eqtl$D1 #data eQTL
# coloc_results_JAK3_eqtl$D2 #data t1d

```

## Regional manhattan plot

```{r}

load("data/export_LDmat/JAK3_eqtl_LDmat.rda")

plot_coloc(genechr = 19,
           fig_start = 17750000,
           fig_end = 18750000,
           coloc_results = coloc_results_JAK3_eqtl$coloc_D1D2,
           data = JAK3_eqtl,
           D1 = coloc_results_JAK3_eqtl$D1,
           D2 = coloc_results_JAK3_eqtl$D2,
           LDmat = JAK3)

ggsave(filename = "figures/JAK3.png", height = 8, width = 6)
```



## Functional variants


```{r}
load("data/export_functional_variants/phenoscanner-entries.RDS")

#Find JAK3 missense variants
JAK3_missense <- functional_variants$JAK3$results %>% 
  filter(consequence == "missense") %>%  
  distinct(rsid) %>% pull()

JAK3_missense #rs55778349

#give betas and se for eQTL and T1D risk (note, this is not MR!)
JAK3_eqtl %>%
  filter(SNP %in% JAK3_missense) %>%
  select(SNP, beta.outcome, se.outcome, pval.outcome, beta.exposure, pval.exposure) %>%
  mutate(across(!matches(c("SNP", "pval.outcome", "pval.exposure")), function(x) signif(x, digits = 2))) #there are none



```



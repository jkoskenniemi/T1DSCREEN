---
title: "IL6R"
author: "Tea Heikkil√§, Emilia Kaiser & Jaakko Koskenniemi"
output: html_document
date: '2023-12-01'
editor_options:
  chunk_output_type: console
---

  Load packages and import data
```{r}
pacman::p_load(tidyverse, data.table, coloc, TwoSampleMR, ggpubr, 
               ieugwasr, rio, here)

here::i_am("analyses/IL6R.Rmd")

source("code/01-Functions.R")

```

# eQTL

```{r}
IL6R_eqtl <- import_data("data/export_harmonization/IL6R_eqtl_TwoSampleMR.csv", 
                         "data/export_harmonization/IL6R_T1D_TwoSampleMR.csv", has_beta = TRUE)

```


## Manhattan plots
```{r}
manhattan_plots(IL6R_eqtl, gene_start=154405193, gene_end=154469450, title = "IL6R")
IL6R_eqtl <- IL6R_eqtl %>% filter(pos.outcome > 154300000 & pos.outcome < 154700000) 
manhattan_plots(IL6R_eqtl, gene_start=154405193, gene_end=154469450, title = "IL6R")

ggsave("figures/IL6R-eQTL-T1D-manhattan.png", height = 6, width = 6)

```

## Coloc assuming 1 causal variant
```{r}
coloc_results_IL6R_eqtl <- analyze_coloc_eqtl(IL6R_eqtl)

```

## Regional manhattan plot

```{r}

load("data/export_LDmat/IL6R_LDmat.RDA")

plot_coloc_IL6R(genechr = 1,
           fig_start = 154300000,
           fig_end = 154700000,
           coloc_results = coloc_results_IL6R_eqtl$coloc_D1D2,
           data = IL6R_eqtl,
           D1 = coloc_results_IL6R_eqtl$D1,
           D2 = coloc_results_IL6R_eqtl$D2,
           LDmat = IL6R)

ggsave(filename = "figures/IL6R.png", height = 8, width = 6)
```

## MR
```{r}

#Find top SNP
coloc_results_IL6R_eqtl$coloc_D1D2$results$snp[which.max(coloc_results_IL6R_eqtl$coloc_D1D2$results$SNP.PP.H4)] #rs10908839

#Find entries for top SNP
IL6R_eqtl_rs10908839   <- IL6R_eqtl %>% 
  filter(SNP == "rs10908839")

IL6R_eqtl_rs10908839   <- IL6R_eqtl_rs10908839 %>% 
  mutate(Fstat = (beta.exposure/se.exposure)^2)

#betas and 95% CI for beta of T1D (not MR!)
exp(IL6R_eqtl_rs10908839$beta.outcome)
exp(IL6R_eqtl_rs10908839$beta.outcome - 1.96 * IL6R_eqtl_rs10908839$se.outcome)
exp(IL6R_eqtl_rs10908839$beta.outcome + 1.96 * IL6R_eqtl_rs10908839$se.outcome)

#Run MR
MR_IL6R_eqtl_rs10908839   <- TwoSampleMR::mr(IL6R_eqtl_rs10908839)

#MR results (unexponentiated)
MR_IL6R_eqtl_rs10908839

#Exponentiate beta and 95% CI
exp(MR_IL6R_eqtl_rs10908839$b)
exp(MR_IL6R_eqtl_rs10908839$b - 1.96*MR_IL6R_eqtl_rs10908839$se)
exp(MR_IL6R_eqtl_rs10908839$b + 1.96*MR_IL6R_eqtl_rs10908839$se)
```


## Functional variants

```{r}

#Load functional variants
load("data/export_functional_variants/phenoscanner-entries.RDS")


#Look for missense variants for IL6R
functional_variants$IL6R$results %>% 
  filter(consequence == "missense") %>%  
  distinct(rsid) #only rs2228145 and rs28730735

#Do we have eQTL data for these variants?
#Load eQTL data for IL6R
IL6R_eqtl_orig <- read_csv("data/export_harmonization/IL6R_eqtl_TwoSampleMR.csv")
IL6R_eqtl_orig %>%
 filter(SNP %in% c("rs2228145", "rs28730735")) %>% 
  select(SNP) #only rs2228145

#Do we have T1D risk data for these variants?
IL6R_T1D <- read_csv("data/export_harmonization/IL6R_T1D_TwoSampleMR.csv")
IL6R_T1D %>%
  filter(SNP %in% c("rs2228145", "rs28730735")) %>% 
  select(SNP) #only rs2228145

IL6R_eqtl %>% 
  filter(SNP %in% c("rs2228145", "rs28730735"))  %>% 
  select(SNP, beta.outcome, se.outcome, pval.outcome, beta.exposure, pval.exposure) %>%
  mutate(across(!matches(c("SNP", "pval.outcome", "pval.exposure")), function(x) signif(x, digits = 2)))
#Does not meet our target for p.val.exposure  < 10^-5
```



## pQTL

Per request of reviewers
```{r}
IL6R_pqtl <- import_data("data/export_harmonization/IL6R_prot_anno_TwoSampleMR.csv",
            "data/export_harmonization/IL6R_T1D_TwoSampleMR.csv", has_beta = TRUE)

IL6R_pqtl <- IL6R_pqtl %>% filter(pval.exposure > 0 & pval.outcome > 0)

coloc_results_IL6R_pqtl <- analyze_coloc_pqtl_nosensitivitity(IL6R_pqtl)
```


